import{m as n,C as l,h as u,d as p}from"./index.ec4027d6.js";function c(e){let a=new DOMParser().parseFromString(e,"text/html");return a.querySelectorAll('a[href*="://"]').forEach(r=>{r.setAttribute("target","_blank")}),a.documentElement.outerHTML}window.Alpine=n;n.store("challenge",{data:{view:""}});n.directive("tooltip",(e,{expression:t},{evaluateLater:a,effect:o})=>{const r=a(t),s=document.createElement("div");s.className="absolute z-50 px-2 py-1 text-xs font-medium text-white bg-gray-900 rounded-md shadow-sm opacity-0 transition-opacity duration-200 pointer-events-none",s.style.top="-30px",s.style.left="50%",s.style.transform="translateX(-50%)";const i=document.createElement("div");i.className="absolute w-2 h-2 bg-gray-900 transform rotate-45",i.style.bottom="-4px",i.style.left="calc(50% - 4px)",e.style.position="relative",s.appendChild(i),e.appendChild(s);function d(){r(g=>{s.textContent=g,s.appendChild(i),s.classList.remove("opacity-0"),s.classList.add("opacity-100")})}function h(){s.classList.remove("opacity-100"),s.classList.add("opacity-0")}e.addEventListener("mouseenter",d),e.addEventListener("mouseleave",h),e.addEventListener("focus",d),e.addEventListener("blur",h)});n.data("Hint",()=>({id:null,html:null,async showHint(e){if(e.target.open){let a=(await l.pages.challenge.loadHint(this.id)).data;if(a.content)this.html=c(a.html);else if(await l.pages.challenge.displayUnlock(this.id)){let r=await l.pages.challenge.loadUnlock(this.id);if(r.success){let i=(await l.pages.challenge.loadHint(this.id)).data;this.html=c(i.html)}else e.target.open=!1,l._functions.challenge.displayUnlockError(r)}else e.target.open=!1}}}));n.data("Challenge",()=>({id:null,next_id:null,submission:"",activeTab:"challenge",solves:[],response:null,share_url:null,max_attempts:0,attempts:0,async init(){u()},closeModal(){document.getElementById("challenge-window").classList.add("hidden"),history.replaceState(null,null," ")},async showChallenge(){this.activeTab="challenge"},async showSolves(){this.solves=await l.pages.challenge.loadSolves(this.id),this.solves.forEach(e=>(e.date=p(e.date).format("MMMM Do, h:mm:ss A"),e)),this.activeTab="solves"},getNextId(){return n.store("challenge").data.next_id},async nextChallenge(){document.getElementById("challenge-window").classList.add("hidden"),setTimeout(()=>{this.$dispatch("load-challenge",this.getNextId())},100)},async getShareUrl(){let e={type:"solve",challenge_id:this.id};const o=(await(await l.fetch("/api/v1/shares",{method:"POST",body:JSON.stringify(e)})).json()).data.url;this.share_url=o},copyShareUrl(){navigator.clipboard.writeText(this.share_url);const e=this.$el.querySelector("button[x-tooltip]");if(e){const t=new MouseEvent("mouseenter");e.dispatchEvent(t),setTimeout(()=>{const a=new MouseEvent("mouseleave");e.dispatchEvent(a)},2e3)}},async submitChallenge(){this.response=await l.pages.challenge.submitChallenge(this.id,this.submission),await this.renderSubmissionResponse()},async renderSubmissionResponse(){this.response.data.status==="correct"&&(this.submission=""),this.max_attempts>0&&this.response.data.status!="already_solved"&&(this.attempts+=1),this.$dispatch("load-challenges")}}));n.data("ChallengeBoard",()=>({loaded:!1,challenges:[],challenge:null,async init(){if(this.challenges=await l.pages.challenges.getChallenges(),this.loaded=!0,window.location.hash){let e=decodeURIComponent(window.location.hash.substring(1)),t=e.lastIndexOf("-");if(t>=0){let o=[e.slice(0,t),e.slice(t+1)][1];await this.loadChallenge(o)}}},getCategories(){const e=[];this.challenges.forEach(t=>{const{category:a}=t;e.includes(a)||e.push(a)});try{const t=l.config.themeSettings.challenge_category_order;if(t){const a=new Function(`return (${t})`);e.sort(a())}}catch(t){console.log("Error running challenge_category_order function"),console.log(t)}return e},getChallenges(e){let t=this.challenges;e!==null&&(t=this.challenges.filter(a=>a.category===e));try{const a=l.config.themeSettings.challenge_order;if(a){const o=new Function(`return (${a})`);t.sort(o())}}catch(a){console.log("Error running challenge_order function"),console.log(a)}return t},async loadChallenges(){this.challenges=await l.pages.challenges.getChallenges()},async loadChallenge(e){await l.pages.challenge.displayChallenge(e,t=>{t.data.view=c(t.data.view),n.store("challenge").data=t.data,n.nextTick(()=>{document.getElementById("challenge-window").classList.remove("hidden"),history.replaceState(null,null,`#${t.data.name}-${e}`)})})}}));n.start();
